## Part 1. Инструмент ipcalc

1.1. Сети и маски

1. Адрес сети 192.167.38.54/13

![](part1.1_1.jpg)

**Изображение 1. Адрес сети 192.167.38.54/13**

2. Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную

![](part1.1_2.jpg)

**Изображение 2. Префиксная и двоичная запись маски 255.255.255.0**

![](part1.1_3.jpg)

**Изображение 3. Обычная и двоичная запись /15**

![](part1.1_4.jpg)

**Изображение 4. Обычная и префиксная запись 11111111.11111111.11111111.11110000**

3. Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4

![](part1.1_5.jpg)

**Изображение 5. Минимальный и максимальный хост в сети 12.167.38.4 при маске /8**

![](part1.1_6.jpg)

**Изображение 6. Минимальный и максимальный хост в сети 12.167.38.4 при маске 11111111.11111111.00000000.00000000**

![](part1.1_7.jpg)

**Изображение 7. Минимальный и максимальный хост в сети 12.167.38.4 при маске 255.255.254.0**

![](part1.1_8.jpg)

**Изображение 8. Минимальный и максимальный хост в сети 12.167.38.4 при маске /4**

1.2. localhost

IP, с которыми можно обратиться к приложению, работающему на Localhost:
127.0.0.2, 127.1.0.1

C которыми нельзя:
194.34.23.100, 128.0.0.1

Так как localhost находится в диапазоне 127.0.0.1 — 127.255.255.254

1.3. Диапазоны и сегменты сетей

1. Частными ip являются те, которые входят в следующие диапазоны

   10.0.0.0 — 10.255.255.255

   100.64.0.0 — 100.127.255.255

   172.16.0.0 — 172.31.255.255

   192.168.0.0 — 192.168.255.255

В связи с этим:

10.0.0.45 -частный

134.43.0.2-публичный

192.168.4.2-частный

172.20.250.4-частный

172.0.2.1-публичный

192.172.0.1-публичный

172.68.0.2-публичный

172.16.255.255-частный

10.10.10.10-частный

192.169.168.1-публичный

2. Адреса для сети 10.10.0.0/18 должны находиться в диапазоне 10.10.0.1-10.10.63.254

Следовательно:

10.0.0.1-не подходит

10.10.0.2-подходит

10.10.10.10-подходит

10.10.100.1-не подходит

10.10.1.255-подходит

## Part 2. Статическая маршрутизация между двумя машинами

Поднимем две виртуальные машины

![](part2.1_1.jpg)

**Изображение 9. Виртуальные машины ws1 и ws2**

Просмотрим существующие сетевые интерфейсы

![](part2.1_2.jpg)

**Изображение 10. Сетевые интерфейсы ws1**

![](part2.1_3.jpg)

**Изображение 11. Сетевые интерфейсы ws2**

Изменим адреса и маски

![](part2.1_4.jpg)

**Изображение 11. Файл etc/netplan/00-installer-config.yaml машины ws1**

![](part2.1_5.jpg)

**Изображение 12. Файл etc/netplan/00-installer-config.yaml машины ws2**

![](part2.1_6.jpg)

**Изображение 13. Вывод sudo netplan apply ws1**

![](part2.1_7.jpg)

**Изображение 14. Вывод sudo netplan apply ws2**

2.1. Добавление статического маршрута вручную

![](part2.1_8.jpg)

**Изображение 15. Статический маршрут между ws1 и ws2**

![](part2.1_9.jpg)

**Изображение 16. Статический маршрут между ws2 и ws1**

![](part2.1_10.jpg)

**Изображение 17. Пинг ws2 с ws1**

![](part2.1_11.jpg)

**Изображение 18. Пинг ws1 с ws2**

2.2. Добавление статического маршрута с сохранением

Добавь статический маршрут от одной машины до другой с помощью файла /etc/netplan/00-installer-config.yaml.

![](part2.2_1.jpg)

**Изображение 19. Файл etc/netplan/00-installer-config.yaml машины ws1**

![](part2.2_2.jpg)

**Изображение 20. Файл etc/netplan/00-installer-config.yaml машины ws2**

![](part2.2_3.jpg)

**Изображение 21. Пинг ws2 с ws1**

![](part2.2_4.jpg)

**Изображение 22. Пинг ws1 с ws2**

## Part 3. Утилита iperf3

3.1. Скорость соединения

Перевести и записать в отчёт:

8 Mbps = 1 MB/s(мегабит/c в мегабайт/c)

100 MB/s = 819200 Kbps(мегабайт/c в килобит/c)

1 Gbps = 1024 Mbps(гигабит/c в мегабит/c)

3.2. Утилита iperf3

![](part3.1_1.jpg)

**Изображение 23. Сервер на ws1**

![](part3.1_2.jpg)

**Изображение 24. Подключение с ws2**

## Part 4. Сетевой экран

4.1. Утилита iptables

Создай файл /etc/firewall.sh, имитирующий файрвол, на ws1 и ws2:

Нужно добавить в файл подряд следующие правила:

1. На ws1 примени стратегию, когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило (это касается пунктов 4 и 5).

2. На ws2 примени стратегию, когда в начале пишется разрешающее правило, а в конце пишется запрещающее правило (это касается пунктов 4 и 5).

3. Открой на машинах доступ для порта 22 (ssh) и порта 80 (http).

4. Запрети echo reply (машина не должна «пинговаться», т. е. должна быть блокировка на OUTPUT).

5. Разреши echo reply (машина должна «пинговаться»).

![](part4.1_1.jpg)

**Изображение 25. Файл /etc/firewall.sh в ws1**

![](part4.1_2.jpg)

**Изображение 26. Файл /etc/firewall.sh в ws2**

Запустить файлы на обеих машинах командами chmod +x /etc/firewall.sh и /etc/firewall.sh

![](part4.1_3.jpg)

**Изображение 27. Запуск /etc/firewall.sh в ws1**

![](part4.1_4.jpg)

**Изображение 28. Запуск /etc/firewall.sh в ws2**

4.2. Утилита nmap

Пропингуем машины

![](part4.2_1.jpg)

**Изображение 29. Пинг ws2**

![](part4.2_2.jpg)

**Изображение 30. Пинг ws1**

Используем nmap

![](part4.2_3.jpg)

**Изображение 31. nmap машины, которая не пингуется**

## Part 5. Статическая маршрутизация сети

5.1. Настройка адресов машин

![](part5.1_1.jpg)

**Изображение 32. Файл etc/netplan/00-installer-config.yaml машины ws11**

![](part5.1_2.jpg)

**Изображение 33. Файл etc/netplan/00-installer-config.yaml машины ws22**

![](part5.1_3.jpg)

**Изображение 34. Файл etc/netplan/00-installer-config.yaml машины ws21**

![](part5.1_4.jpg)

**Изображение 35. Файл etc/netplan/00-installer-config.yaml машины r1**

![](part5.1_5.jpg)

**Изображение 36. Файл etc/netplan/00-installer-config.yaml машины r2**

Проверим что адреса машин заданы верно

![](part5.1_6.jpg)

**Изображение 37. ip -4 a ws11**

![](part5.1_7.jpg)

**Изображение 38. ip -4 a ws22**

![](part5.1_8.jpg)

**Изображение 39. ip -4 a ws21**

![](part5.1_9.jpg)

**Изображение 40. ip -4 a r1**

![](part5.1_10.jpg)

**Изображение 41. ip -4 a r2**

Пропингуем машины

![](part5.1_11.jpg)

**Изображение 42. Пинг ws22 c ws21**

![](part5.1_12.jpg)

**Изображение 43. Пинг ws11 c r1**

5.2. Включение переадресации IP-адресов

Включим переадресацию на роутерах на непостоянной основе

![](part5.2_1.jpg)

**Изображение 44. Команда sysctl -w net.ipv4.ip_forward=1 на r1**

![](part5.2_2.jpg)

**Изображение 45. Команда sysctl -w net.ipv4.ip_forward=1 на r2**

Включим переадресацию на постоянной основе

![](part5.2_3.jpg)

**Изображение 46. Файл sysctl.conf на r1**

![](part5.2_4.jpg)

**Изображение 47. Файл sysctl.conf на r2**

5.3. Установка маршрута по умолчанию

Настроим маршрут по умолчанию для ws11, ws22, ws21

![](part5.3_1.jpg)

**Изображение 48. Файл etc/netplan/00-installer-config.yaml машины ws11**

![](part5.3_2.jpg)

**Изображение 49. Файл etc/netplan/00-installer-config.yaml машины ws22**

![](part5.3_3.jpg)

**Изображение 50. Файл etc/netplan/00-installer-config.yaml машины ws21**

Проверим что маршрут добавился в таблицу маршрутизации

![](part5.3_4.jpg)

**Изображение 51. Команда ip r для ws11**

![](part5.3_5.jpg)

**Изображение 52. Команда ip r для ws22**

![](part5.3_6.jpg)

**Изображение 53. Команда ip r для ws21**

Пропингуем r2 с ws11

![](part5.3_7.jpg)

**Изображение 54. Пинг r2 с ws11**

![](part5.3_8.jpg)

**Изображение 55. Команда tcpdump -tn -i eth0 на r2**

5.4. Добавление статических маршрутов

Добавим в r1 и r2 статические маршруты

![](part5.4_1.jpg)

**Изображение 56. Файл etc/netplan/00-installer-config.yaml машины r1**

![](part5.4_2.jpg)

**Изображение 57. Файл etc/netplan/00-installer-config.yaml машины r2**

Просмотрим таблицы маршрутов

![](part5.4_3.jpg)

**Изображение 58. Команда ip r на r1**

![](part5.4_4.jpg)

**Изображение 59. Команда ip r на r2**

![](part5.4_5.jpg)

**Изображение 60. Команда ip r list 10.10.0.0/18 на ws11**

![](part5.4_6.jpg)

**Изображение 61. Команда ip r list 0.0.0.0/0 на ws11**

Был выбран более точный маршрут, который указывает конкретный путь для доставки пакета на узел сети назначения.

5.5. Построение списка маршрутизаторов

![](part5.5_1.jpg)

**Изображение 62. Команда tcpdump -tnv -i eth0 на r1**

![](part5.5_2.jpg)

**Изображение 63. Traceroute от ws11 до ws21**

Traceroute — это инструмент для отслеживания пути, по которому проходят данные в сети. Он работает с помощью пакетов, у которых постепенно увеличивается поле TTL (Time to Live). Каждый маршрутизатор уменьшает TTL на 1, и когда TTL достигает 0, маршрутизатор отправляет ответ о времени истечения. Таким образом, traceroute отправляет пакеты с увеличивающимся TTL и получает ответы от каждого маршрутизатора на пути, показывая, сколько времени занимает передача данных через каждый узел и какие маршрутизаторы задействованы.

5.6. Использование протокола ICMP при маршрутизации

Запустим перехват трафика и пропингуем несуществующий IP адрес

![](part5.6_1.jpg)

**Изображение 64. tcpdump -n -i eth0 icmp на r1**

![](part5.6_2.jpg)

**Изображение 65. ping -c 1 10.30.0.111 на ws11**

## Part 6. Динамическая настройка IP с помощью DHCP

1. Укажи адрес маршрутизатора по умолчанию, DNS-сервер и адрес внутренней сети. Пример файла для r2:

![](part6_1.jpg)

**Изображение 66. Файл /etc/dhcp/dhcpd.conf на r2**

2. В файле resolv.conf пропиши nameserver 8.8.8.8.

![](part6_2.jpg)

**Изображение 67. Файл /etc/resolv.conf на r2**

Перезагрузи службу DHCP командой systemctl restart isc-dhcp-server. Машину ws21 перезагрузи при помощи reboot и через ip a покажи, что она получила адрес. Также пропингуй ws22 с ws21.

![](part6_3.jpg)

**Изображение 68. ip a на ws21**

![](part6_4.jpg)

**Изображение 69. Пинг ws22 с ws21**

Укажем MAC-адрес у ws11

![](part6_5.jpg)

**Изображение 70. Файл etc/netplan/00-installer-config.yaml машины ws11**

Для r1 настрой аналогично r2, но сделай выдачу адресов с жесткой привязкой к MAC-адресу (ws11).

![](part6_6.jpg)

**Изображение 71. Файл /etc/dhcp/dhcpd.conf на r1**

Запросить с ws21 обновление ip адреса

![](part6_7.jpg)

**Изображение 72. Замена ip на ws21**

sudo dhclient -r -удалить ip sudo dhclient -v -добавить ip
